browser_polyfill.runtime.onMessage.addListener((e,t,o)=>{if(e.bulk_texter_pro)return"NAVIGATE_TO_UPLOAD_PHOTOS"===e.eventType?(o(clickUploadPhotosTab()),!0):"UPLOAD_PHOTO"===e.eventType?(o(uploadPhoto(e.payload.photoBase64)),!0):"CHECK_PHOTO_UPLOAD_FINISHED"===e.eventType?(o(checkIfPhotoUploadFinished()),!0):"NAVIGATE_TO_GOOGLE_PHOTOS"===e.eventType?(o(clickYourPhotos()),!0):"SELECT_PHOTO"===e.eventType?(o(selectPhoto(e.payload.photoUrl)),!0):"SELECT_PHOTO_BY_FILE_NAME"===e.eventType?(o(selectPhotoByFilename(e.payload.photoFileName)),!0):"CLICK_PHOTO_SELECT_BUTTON"===e.eventType?(o(clickSelectButton()),!0):"LET_USER_CHOOSE_PHOTO"===e.eventType?(letUserChoosePhoto(),o(!0)):void 0});const clickUploadPhotosTab=()=>{let e=1;if(document.querySelector('input[type="file"]'))return{status:"success",uiVersion:e=2};let t=Array.from(document.querySelectorAll("div")).find(e=>"Upload photos"===e.textContent);return t||(t=document.querySelector('button[role="tab"][id="1"]'))&&(e=2),(t=t||document.querySelector(".picker-main-container .goog-tab-bar-top .goog-tab:nth-of-type(3) .picker-navpane-horizontal-tabcontent"))&&null!==t.offsetParent?(simulateClick(t),{status:"success",uiVersion:e}):void 0},uploadPhoto=e=>{var t,e=base64toFile(e,"photoUpload.png"),o=document.querySelector('input[type="file"]');if(o)return(t=new DataTransfer).items.add(e),o.files=t.files,emitEvent(o,"change"),!0},checkIfPhotoUploadFinished=()=>{var e;return"none"===document.querySelector(".goog-inline-block.progress-bar-horizontal.picker-progress-bar")?.parentElement?.style?.display||!(!(e=document.querySelector('div[role="progressbar"]'))||null!=e.offsetParent)||void 0},clickSelectButton=()=>{let e=document.querySelector('div[role="button"].picker-select-control-enabled');return e&&null!==e.offsetParent&&"false"===e.getAttribute("aria-disabled")||(e=document.querySelector('button[aria-label^="Insert"]'))&&null!==e.offsetParent?(simulateClick(e),!0):void 0},clickYourPhotos=()=>{let e=Array.from(document.querySelectorAll("div")).find(e=>"Your photos"===e.textContent);if((e=(e=e||document.querySelector('button[role="tab"][id="0"]'))||document.querySelector(".picker-main-container .goog-tab-bar-top .goog-tab:nth-of-type(1) .picker-navpane-horizontal-tabcontent"))&&null!==e.offsetParent)return simulateClick(e),!0},selectPhoto=e=>{e=e.split("=w")[0],e=document.querySelector(`img[src^="${e}"]`);if(e&&null!==e.offsetParent)return simulateClick(e),!0;scrollDown()},selectPhotoByFilename=e=>{e=document.querySelector(`img[alt="${e}" i], img[title="${e}" i]`);if(e&&null!==e.offsetParent)return simulateClick(e),!0;scrollDown()},scrollDown=()=>{let e=document.querySelector('div[role="tabpanel"]')?.children[1]?.children[0]?.children[0]?.children[0]?.children[0]?.children[0]?.children[0]?.children[1]?.children[1];(e=e||document.querySelector("#doclist")?.children[0]?.children[2]?.children[1]?.children[0]?.children[1]?.children[0]?.children[0]?.children[0]?.children[0])&&(e.scrollTop=e.scrollHeight)},letUserChoosePhoto=async()=>{await keepTrying(()=>(document.querySelector("body").onclick=e=>{let t=Array.from(document.querySelectorAll("div")).find(e=>"Select"===e.textContent);(t=t||document.querySelector('button[aria-label^="Insert"]')).contains(e.target)&&(e.preventDefault(),e.stopPropagation(),e=document.querySelector('div[role="option"][aria-checked="true"], div[role="option"][aria-selected="true"]')?.querySelector("img")?.src,passMessage("PHOTO_CHOSEN",{photoUrl:e}))},!0),!0)};
