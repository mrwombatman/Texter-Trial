class GoogleVoiceSiteManager{initialize=()=>{this.selectors={gvAccountEmail:'a[href^="https://accounts.google.com/SignOutOptions?"]',gvMessagesTab:'a[gv-test-id="sidenav-messages"]',gvLoadingIcon:'div[ng-if="ctrl.shouldShowThreadListLoadWheel()"], div[class="gvMessagingView-loading"]',gvNumInputButton:'div[gv-id="send-new-message"]',gvNumInput:'gv-recipient-picker-input-ng2 .input-field input, gv-recipient-picker input[ng-show="ctrl.allowToAddRecipients()"], gv-recipient-picker input[placeholder="Type a name or phone number"]',gvStartChatButton:'gv-contact-list div[role="button"], gv-contact-list-ng2 .send-to-button, gv-contact-list div[ng-class="::ctrl.CSS.SEND_TO_PHONE_NUMBER"]',gvRecipientButtonOld:'gmat-input-chip[gv-id="chip-phone-number"], div[aria-label="Select recipients"] md-chips md-chip button',gvRecipientButtonNew:'mat-chip-row .mat-mdc-chip-action-label div[aria-hidden="true"]',gvMessageEditor:'div.message-input-container textarea, textarea[gv-test-id="gv-message-input"], textarea[aria-label="Type a message"], textarea[aria-label="Add a caption"], #gv-message-input, div[gv-test-id="gv-message-input"]',gvSendButtonOld:'gv-icon-button[icon-name="send"] button[aria-label="Send message"]',gvSendButtonNew:'button.gv-icon-button mat-icon[svgicon="send"], gv-icon-button-ng2[gv-test-id="send_message"] button, gv-icon-button-ng2[icon-name="send"][label="Send message"] button',gvSendingNote:'div.status:not([aria-hidden]), gv-message-item div[ng-if="ctrl.shouldDisplayTransmissionStatus()"] div[ng-if="!ctrl.isFailed()"]',gvMostRecentMessages:'div[gv-id="content"] div[gv-test-id="bubble"] gv-annotation, gv-text-message-item gv-annotation',gvAddImageButton:'button.gv-icon-button mat-icon[svgicon="image"], gv-icon-button-ng2[gv-test-id="add_image"]',gvThumbnail:'div.content[style^="background-image:"], div.gvMessageEntry-thumbnail'},this.sendQueue=new SendQueue,this.sendQueue.initialize("Google Voice",this.getSendExecutionQueue,this.verifyAccount,this.verifyNumberReady)};verifyNumberReady=()=>{return!window.location.href.includes("/about")&&!window.location.href.includes("/signup")&&!document.querySelector(".gvMessagingView-actionButtonDisabledText")&&(!!document.querySelector(this.selectors.gvMessagesTab)||void 0)};verifyAccount=e=>{if(!e?.subscriptionsByProduct?.["Google Voice"]?.length)return!1;e=e.subscriptionsByProduct["Google Voice"];let t=document.querySelector(this.selectors.gvAccountEmail);if(t||e.some(e=>t=document.querySelector(`a[aria-label$="(${e})"], a[aria-label$="${e}"]`)),t){const n=t.getAttribute("aria-label");var s=n.match(/([^\s\(]*@[^\)\s]*)/)?.[1];return{verified:e.some(e=>simplifyString(n).endsWith(simplifyString(e)))||!1,textingPlatformEmail:s}}};getSendExecutionQueue=()=>{var e=[this.switchToMessagesTab,this.verifyPageReady,this.showNumberInput,this.copyMessageNumbers,this.fillNumberInput,this.startChat,this.verifyRecipientCount,this.clickAddImage,this.navigateToGooglePhotosTab,this.selectPhoto,this.clickPhotoSelectButton,this.sendPhoto,this.sendPhotoDelay,this.confirmPhotoSent],t=[this.switchToMessagesTab,this.verifyPageReady,this.showNumberInput,this.copyMessageNumbers,this.fillNumberInput,this.startChat,this.verifyRecipientCount,this.clickAddImage,this.navigateToUploadPhotosTab,this.uploadPhoto,this.checkIfPhotoUploadFinished,this.clickPhotoSelectButton,this.writeMessage,this.sendPhoto,this.confirmPhotoSent,this.confirmSent],s=[this.switchToMessagesTab,this.verifyPageReady,this.showNumberInput,this.copyMessageNumbers,this.fillNumberInput,this.startChat,this.verifyRecipientCount,this.writeMessage,this.sendMessage,this.confirmSent];return this.sendQueue.currentMessageSending.photoBase64?[...t]:!this.sendQueue.currentMessageSending.photoUrl&&!this.sendQueue.currentMessageSending.photoFileName||this.sendQueue.currentMessageSending.photoSelected?s:[...e,...s]};verifyPageReady=()=>{var e=document.querySelector(this.selectors.gvLoadingIcon);return!e||null===e.offsetParent};switchToMessagesTab=()=>{var e=document.querySelector(this.selectors.gvMessagesTab);return e&&simulateClick(e),!0};showNumberInput=()=>{var e=document.querySelector(this.selectors.gvNumInputButton);if(e&&null!==e.offsetParent)return simulateClick(e),!0};copyMessageNumbers=()=>(this.sendQueue.currentMessageSending.phoneNumberQueue=[...this.sendQueue.currentMessageSending.phoneNumbers],!0);fillNumberInput=()=>{var e=document.querySelector(this.selectors.gvNumInput);if(e&&null!==e.offsetParent)return simulateClick(e),e.focus(),emitEvent(e,"focusin"),e.value=this.sendQueue.currentMessageSending.phoneNumberQueue[0],simulateKeyPress(e),emitEvent(e,"change"),emitEvent(e,"input"),(e=document.querySelector(this.selectors.gvNumInput))&&e.value===this.sendQueue.currentMessageSending.phoneNumberQueue[0]};startChat=()=>{var e,t=document.querySelector(this.selectors.gvStartChatButton),s=t&&null!==t.offsetParent;if(s||(e=document.querySelector(this.selectors.gvNumInput))&&(simulateKeyPress(e),emitEvent(e,"change"),emitEvent(e,"input")),s)return simulateClick(t),this.sendQueue.currentMessageSending.phoneNumberQueue.shift(),0<this.sendQueue.currentMessageSending.phoneNumberQueue.length&&(this.sendQueue.currentSendExecutionQueue.unshift(this.startChat),this.sendQueue.currentSendExecutionQueue.unshift(this.fillNumberInput)),!0};verifyRecipientCount=()=>{let e=[...document.querySelectorAll(this.selectors.gvRecipientButtonNew)];if(e.length||(e=[...document.querySelectorAll(this.selectors.gvRecipientButtonOld)]),this.sendQueue.currentMessageSending.phoneNumbers.length===e.length)return!0};writeMessage=()=>{var e,t;return!!this.sendQueue.currentMessageSending.text&&(e=this.sendQueue.currentMessageSending.text,(t=document.querySelector(this.selectors.gvMessageEditor))&&null!==t.offsetParent?(emitEvent(t,"focusin"),t.value=e,t.innerText=e,emitEvent(t,"change"),emitEvent(t,"input"),!0):void 0)};sendMessage=()=>{var e,t=document.querySelector(this.selectors.gvMessageEditor);if(t&&!this.sendQueue.abortSend)return t=document.querySelector(this.selectors.gvSendButtonOld),e=document.querySelector(this.selectors.gvSendButtonNew),t&&null!==t.offsetParent&&"false"===t.getAttribute("aria-disabled")?(simulateClick(t),!0):e&&null!==e.offsetParent&&!e.disabled?(simulateClick(e),!0):void 0};confirmSent=()=>{if(!document.querySelector(this.selectors.gvSendingNote)){var e=Array.from(document.querySelectorAll(this.selectors.gvMostRecentMessages)).map(e=>e.innerText).join(),t=removeWhitespace(removeNonAscii(this.sendQueue.currentMessageSending.text));if(removeWhitespace(removeNonAscii(e)).includes(t))return!0}};clickAddImage=()=>{var e=document.querySelector(this.selectors.gvAddImageButton);if(e&&null!==e.offsetParent)return simulateClick(e),!0};navigateToUploadPhotosTab=async()=>{var e=await passMessage("PROXY_TO_CONTENT_SCRIPTS",{eventType:"NAVIGATE_TO_UPLOAD_PHOTOS"});if(e)return this.sendQueue.currentMessageSending.uiVersion=e.uiVersion,!0};uploadPhoto=async()=>{if(await passMessage("PROXY_TO_CONTENT_SCRIPTS",{eventType:"UPLOAD_PHOTO",photoBase64:this.sendQueue.currentMessageSending.photoBase64}))return!0};checkIfPhotoUploadFinished=async()=>{return 2===this.sendQueue.currentMessageSending.uiVersion||!!await passMessage("PROXY_TO_CONTENT_SCRIPTS",{eventType:"CHECK_PHOTO_UPLOAD_FINISHED"})||void 0};navigateToGooglePhotosTab=async()=>{if(await passMessage("PROXY_TO_CONTENT_SCRIPTS",{eventType:"NAVIGATE_TO_GOOGLE_PHOTOS"}))return!0};selectPhoto=async()=>{let e;if(e=this.sendQueue.currentMessageSending.photoFileName?await passMessage("PROXY_TO_CONTENT_SCRIPTS",{eventType:"SELECT_PHOTO_BY_FILE_NAME",photoFileName:this.sendQueue.currentMessageSending.photoFileName}):await passMessage("PROXY_TO_CONTENT_SCRIPTS",{eventType:"SELECT_PHOTO",photoUrl:this.sendQueue.currentMessageSending.photoUrl}))return!0};clickPhotoSelectButton=async()=>{return 2===this.sendQueue.currentMessageSending.uiVersion||await passMessage("PROXY_TO_CONTENT_SCRIPTS",{eventType:"CLICK_PHOTO_SELECT_BUTTON"})?this.sendQueue.currentMessageSending.photoSelected=!0:void 0};sendPhoto=()=>{var e,t=document.querySelector(this.selectors.gvThumbnail);if(t&&!this.sendQueue.abortSend)return t=document.querySelector(this.selectors.gvSendButtonOld),e=document.querySelector(this.selectors.gvSendButtonNew),t&&null!==t.offsetParent&&"false"===t.getAttribute("aria-disabled")?(simulateClick(t),!0):e&&null!==e.offsetParent&&!e.disabled?(simulateClick(e),!0):void 0};sendPhotoDelay=async()=>{var e=Math.max(5e3,this.sendQueue.sendInterval);return await sleep(e),!0};confirmPhotoSent=()=>{var e=document.querySelector(this.selectors.gvSendingNote);if(!e&&document.querySelector("gv-image-attachment img.image"))return!0}}(new GoogleVoiceSiteManager).initialize();
