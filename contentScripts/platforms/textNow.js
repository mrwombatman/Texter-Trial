class TextNowSiteManager{initialize=()=>{this.injectUserSpaceJS(),this.sendQueue=new SendQueue,this.sendQueue.initialize("TextNow",this.getSendExecutionQueue,this.verifyAccount,this.verifyNumberReady)};injectUserSpaceJS=()=>{var e=document.createElement("script");e.src=chrome.runtime.getURL("contentScripts/platforms/textNowUserScript.js"),e.onload=function(){this.remove()},document.body.appendChild(e)};verifyNumberReady=()=>{return!window.location.href.includes("/login")&&(5<(document.querySelector("#recent-header .phoneNumber")?.innerText)?.length||void 0)};verifyAccount=async e=>{if(!e?.subscriptionsByProduct?.TextNow?.length)return!1;var e=e.subscriptionsByProduct.TextNow,t=document.querySelector("#btp-variables");if(t?.dataset){const n=t.dataset.textNowUserEmail;t=t.dataset.textNowUserName;if(n||t)return!!e.some(e=>simplifyString(n)===simplifyString(e))||(e=(await browser_polyfill.storage.sync.get("textNowUserName"))?.textNowUserName)===t||(e?{verified:!1,textingPlatformEmail:n}:(await browser_polyfill.storage.sync.set({textNowUserName:t}),!0))}};getSendExecutionQueue=()=>{var e=[this.verifyPageReady,this.showNumberInput,this.copyMessageNumbers,this.fillNumberInput,this.startChat,this.verifyRecipientCount,this.uploadPhoto,this.sendPhoto],t=[this.verifyPageReady,this.showNumberInput,this.copyMessageNumbers,this.fillNumberInput,this.startChat,this.verifyRecipientCount,this.writeMessage,this.sendMessage,this.confirmThreadHeaderUpdated,this.confirmSent];return this.sendQueue.currentMessageSending.photoBase64?[...e,...t]:t};verifyPageReady=()=>{var e=document.querySelector("#page-loading");return!e||null===e.offsetParent&&"none"===e.style.display};showNumberInput=()=>{var e=document.querySelector("#newText");if(e&&null!==e.offsetParent)return simulateClick(e),!0};copyMessageNumbers=()=>(this.sendQueue.currentMessageSending.phoneNumberQueue=[...this.sendQueue.currentMessageSending.phoneNumbers],!0);fillNumberInput=()=>{var e=document.querySelector("input.newConversationTextField");if(e&&null!==e.offsetParent)return e.value=this.sendQueue.currentMessageSending.phoneNumberQueue[0],emitEvent(e,"input"),(e=document.querySelector("input.newConversationTextField"))&&e.value===this.sendQueue.currentMessageSending.phoneNumberQueue[0]};startChat=()=>{var e=document.querySelector("input.newConversationTextField");if(e&&null!==e.offsetParent)return emitEvent(e,"blur"),this.sendQueue.currentMessageSending.phoneNumberQueue.shift(),0<this.sendQueue.currentMessageSending.phoneNumberQueue.length&&(this.sendQueue.currentSendExecutionQueue.unshift(this.startChat),this.sendQueue.currentSendExecutionQueue.unshift(this.fillNumberInput)),!0};verifyRecipientCount=()=>{if(this.sendQueue.currentMessageSending.phoneNumbers.length===document.querySelectorAll(".recipients .uikit-badge").length)return!0};writeMessage=()=>{var e,t;return!!this.sendQueue.currentMessageSending.text&&(e=this.sendQueue.currentMessageSending.text,(t=document.querySelector("textarea#text-input"))&&null!==t.offsetParent?(t.value=e,t.innerText=e,emitEvent(t,"input"),!0):void 0)};sendMessage=()=>{var e;return document.querySelector("textarea#text-input")&&!this.sendQueue.abortSend&&(e=document.querySelector("#send_button"))&&null!==e.offsetParent?(simulateClick(e),!0):void 0};confirmThreadHeaderUpdated=()=>{var e=document.querySelector("h3.conversation-title__name");if(e&&null!==e.offsetParent)return!0};confirmSent=()=>{var t=document.querySelectorAll(".message-text .uikit-chat-item__bubble-text");let n=!1;if(t&&t.length){let e=t.length-1;for(e;!n&&0<=e;e--){var r=removeWhitespace(removeNonAscii(this.sendQueue.currentMessageSending.text)),i=removeWhitespace(removeNonAscii(t[t.length-1].innerText));n=i===r}}if(n)return!0};uploadPhoto=async()=>{var e=this.sendQueue.currentMessageSending.photoBase64,t=document.querySelector(".view-with-fixed-footer-view.dz-clickable");return simulateImageDrop(t,e),!0};sendPhoto=async()=>{var e=document.querySelector("#send_photo_button");if(e&&null!==e.offsetParent)return simulateClick(e),await sleep(this.sendQueue.sendInterval),!0}}(new TextNowSiteManager).initialize();
