{var browser_polyfill;"undefined"!=typeof browser?browser_polyfill=browser:"undefined"!=typeof chrome&&(browser_polyfill=chrome);const a=()=>{var e=document.getElementById("bulk-texter-pro-api-loaded");if(e)throw new Error("Bulk Texter Pro already loaded on page! Please install only one copy of Bulk Texter Pro.");(e=document.createElement("input")).type="hidden",e.id="bulk-texter-pro-api-loaded",document.documentElement.appendChild(e)},b=(a(),window.addEventListener("message",async a=>{if(a.source===window&&a?.origin===window.origin&&a?.data?.type&&"BulkTexterPro_ExtensionAPIRequest"===a.data.type&&a?.data?.endpoint&&a?.data?.promiseId)try{var c,_=a.data.promiseId,S=a.data.endpoint,P={getVersion:d,saveAppToken:e,getAppToken:f,saveUser:g,saveFormEntryState:h,getFormEntryState:i,saveCSVUploadState:j,getCSVUploadState:k,saveSettingsState:l,getSettingsState:m,getBatchIndex:n,saveBatchIndex:o,getBatch:p,deleteBatches:q,reloadExtension:C,getReloadError:D,exportAllData:y,getPermissions:s,getExpectedPermissions:t,requestPermissions:u,scheduleMessages:r,muteAnnouncement:v,getMutedAnnouncements:w,getFirstVersion:x,chooseFromGooglePhotos:E,localStorageGet:z,localStorageSet:B,localStorageRemove:A};if(!P[S])throw new Error("API Endpoint not supported.");c=await P[S](a.data.payload),b(_,c)}catch(e){P=`Error in API "${a?.data?.endpoint}": `+(e.message||e);console.error(P),C(P)}}),(e,r)=>{window.postMessage({type:"BulkTexterPro_ExtensionAPIResponse",promiseId:e,response:r},window.origin)}),c=async(e,r)=>{let t,o;var a=new Promise((e,r)=>{t=e,o=r});return browser_polyfill.runtime.sendMessage({bulk_texter_pro:!0,eventType:e,payload:r},e=>{var r=chrome.runtime.lastError;if(r)return console.error("Error passing message: "+r.message),o(r.message);t(e)}),a},d=()=>browser_polyfill?.runtime?.getManifest()?.version,e=async e=>{e=e?.appToken;return browser_polyfill.storage.sync.set({BulkTexterPro_AppToken:e})},f=async()=>{return(await browser_polyfill.storage.sync.get("BulkTexterPro_AppToken")).BulkTexterPro_AppToken},g=async e=>{e=e?.user;return browser_polyfill.storage.sync.set({BulkTexterPro_User:e})},h=async e=>{e=e?.formEntryState;return browser_polyfill.storage.local.set({formEntryState:e})},i=async()=>{return(await browser_polyfill.storage.local.get("formEntryState")).formEntryState},j=async e=>{e=e?.csvUploadState;return browser_polyfill.storage.local.set({csvUploadState:e})},k=async()=>{return(await browser_polyfill.storage.local.get("csvUploadState")).csvUploadState},l=async e=>{e=e?.settingsState;return browser_polyfill.storage.local.set({settingsState:e})},m=async()=>{return(await browser_polyfill.storage.local.get("settingsState")).settingsState},n=async()=>{var e=await browser_polyfill.storage.local.get("batchIndex");return e&&e.batchIndex?e.batchIndex:{}},o=async e=>{e=e?.batchIndex;return browser_polyfill.storage.local.set({batchIndex:e})},p=async e=>{e=e?.batchId;return store.getFullMessageBatch(e)},q=async e=>{e=e?.batchIds;return browser_polyfill.storage.local.remove(e)},r=async e=>{var e=e?.batch,r=await n();return r[e.batchId]={timestamp:e.timestamp,messageCount:e.messages.length,sendInterval:e.sendInterval,status:e.status||"pending",metadata:e.metadata},await browser_polyfill.storage.local.set({[e.batchId]:{messages:e.messages,longMetadata:{template:e.template},photoBase64:e.photoBase64}}),await browser_polyfill.storage.local.set({batchIndex:r}),c("SEND_NOW")},s=async()=>c("GET_PERMISSIONS"),t=()=>{var e=browser_polyfill.runtime.getManifest();return{origins:e.host_permissions,permissions:e.permissions}},u=async e=>e?.permissions?c("REQUEST_PERMISSIONS",{requested:e.permissions}):c("REQUEST_PERMISSIONS",{requested:t()}),v=async e=>{var e=e?.announcementId,r=await w();return r.add(e),browser_polyfill.storage.sync.set({BulkTexterPro_MutedAnnouncements:[...r]})},w=async()=>{var e=await browser_polyfill.storage.sync.get("BulkTexterPro_MutedAnnouncements");return new Set(e.BulkTexterPro_MutedAnnouncements||[])},x=async()=>{return(await browser_polyfill.storage.sync.get("First_Version"))?.First_Version},y=async()=>{var e=await browser_polyfill.storage.sync.get();delete e.BulkTexterPro_AppToken,delete e.BulkTexterPro_User;const r=await browser_polyfill.storage.local.get();return Object.keys(r).forEach(e=>{r[e].photoBase64&&delete r[e].photoBase64}),{localStorage:r,browserSyncedStorage:e}},z=async e=>{return(await browser_polyfill.storage.local.get(e?.key))?.[e?.key]},A=async e=>{return await browser_polyfill.storage.local.remove(e?.key)},B=async e=>{return await browser_polyfill.storage.local.set(e?.value)},C=async r=>{r=r.hasOwnProperty("error")?r.error:r;try{var e=(await browser_polyfill.storage.local.get("reload_last_timestamp"))?.reload_last_timestamp,t=Math.floor((new Date).getTime()/1e3);if(r&&(r&&e&&t-e<2))return console.error(r),void console.error("Stuck in reload loop, reach out to support.");await browser_polyfill.storage.local.set({reload_error:r,reload_last_timestamp:t}),browser_polyfill.runtime.sendMessage({bulk_texter_pro:!0,eventType:"RELOAD_EXTENSION"})}catch(e){console.error(`Error reloading extension: ${e}. Original error: `+r)}setTimeout(()=>window.location.reload(),1e3)},D=async()=>{var e;return(e=(await browser_polyfill.storage.local.get("reload_error"))?.reload_error)&&await browser_polyfill.storage.local.remove("reload_error"),e},E=async()=>{c("CHOOSE_FROM_GOOGLE_PHOTOS")};browser_polyfill.runtime.onMessage.addListener(function(e,r,t){return e.bulk_texter_pro&&"PROXY_PHOTO_CHOSEN"===e.eventType?(window.postMessage({type:"BulkTexterPro_GooglePhotoChosen",photoUrl:e.payload.photoUrl},window.origin),t(!0)):void 0})}
